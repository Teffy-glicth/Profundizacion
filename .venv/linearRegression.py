import numpy as np
import pandas as pd
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import io
import base64
from sklearn.linear_model import LinearRegression

data = {
    "Size": [82.46149697, 97.79797442, 24.69421235, 26.65897834, 27.29083448, 76.33809044, 17.56550701, 31.40625023, 17.97910012, 32.63338163, 94.24380749, 15.46942489, 40.47986251, 69.64075161, 38.22386446, 76.78351592, 58.4751358, 76.38317469, 14.15546594, 42.92547086, 48.54515516, 24.10445668, 48.15085884, 35.79858357, 67.74741088, 27.5901138, 83.26788955, 50.78744817,
            16.22257542, 45.24629216, 25.93316973, 58.4504608, 30.22247139, 94.75150389, 59.65811397, 78.72118777, 22.16106913, 58.06132655, 73.97344443, 81.1441411, 85.99024416, 49.35961956, 31.46616277, 14.22788102, 34.89527289, 49.44870606, 14.54174914, 37.25602195, 50.5824238, 18.40059784, 59.60863776, 32.53540954, 45.8787452, 79.99837208, 18.71170567, 93.98674883, 
            61.81361751, 27.82586918, 65.55046311, 12.79289533, 78.51638996, 45.87121882, 25.83327377, 58.26899312, 19.91070662, 66.41280598, 40.3607978, 74.40934655, 18.58061861, 35.38830637, 43.04260475, 76.01758206, 48.36623238, 19.80335645, 11.2402959, 93.06173794, 65.69236926, 87.28566588, 70.71494875, 24.06820815, 51.97439859, 39.64785813, 75.09985039, 79.07806675,
            71.75896981, 90.81189155, 27.84813853, 95.74884837, 26.28333543, 74.22736949, 32.42240504, 28.44823791, 14.5673852, 67.54527739, 14.27536061, 56.07849932, 19.82924362, 96.19982583, 89.88918442,48.46482532, 46.87214664, 94.36019708, 41.63813888, 18.09701727, 62.16981396, 67.02891169, 68.93479438, 29.36924503, 96.59825365, 99.44680675, 53.24395388, 29.0217569,
            14.47232643, 14.43761275, 54.30671484, 58.35005068, 32.40447905, 81.72155489, 64.86618557, 16.04164391, 12.75239008, 46.45643739, 50.84176902, 16.8485563, 22.02185795, 14.87881393, 38.8214364, 50.62585549, 63.47502336, 63.03880307, 95.27319883, 23.77771318, 13.81271277, 89.75566386, 21.29688709, 50.15497388, 12.60765787, 95.79612429, 87.63741084, 99.70594859,
            63.68405818, 58.64469185, 65.04894691, 34.66447663, 39.97942993, 70.50578675, 10.00243947, 65.27257666, 46.24875308, 69.70445469, 99.8045962, 26.27832555, 12.3245585, 14.30729604, 47.96755475, 12.05090302, 34.49307536, 71.85827169, 28.42172048, 53.17905401, 38.60383915, 47.29434149, 76.99650491, 80.76035414, 36.96986942, 44.68129279, 20.50873843, 94.21676647,
            50.74435553, 27.51841703, 64.46444234, 87.63099674, 10.01509658, 82.79766174, 91.25293423, 79.80083587, 97.92726634, 33.20220124, 93.2815739, 70.14373748, 92.3289113, 85.50750662, 11.12340108, 12.74255708, 32.53644837, 62.8025766, 13.87754754, 92.15260969, 88.25012803, 99.13989404, 38.53499721, 86.76477876, 76.00161889, 58.87296251, 61.85226295, 87.55053191,
            94.12498917, 19.20886073, 40.29163731,12.39450332, 29.61981186, 65.13388346, 69.79708701, 86.26456036, 68.46153761, 95.08926659, 17.81526012, 18.85952488, 93.97931721, 55.26930966, 80.76444632, 22.23890437, 32.07642439, 44.51574945, 45.61233585, 18.8418027, 11.13665425, 22.81567528, 41.93175422, 48.2160226, 73.33519861, 66.50845003, 55.56080685, 21.10171233,
            63.43189573, 95.91008755, 39.74132392, 25.3225818, 52.51861252, 96.06526396, 58.81448665, 62.57804346, 67.04296941, 96.09905008, 34.71164265, 43.51200488, 48.96328566, 88.94147193, 52.13729359, 36.46831523, 98.09314173, 91.40284676, 45.66065659, 77.36641079, 47.9238753, 81.96455442, 34.38269369, 92.13148467, 69.38887516, 36.28614881, 92.18097084, 65.6368462,
            81.6235611, 59.23820579, 61.6307339, 14.90832101, 39.29637511, 79.83221485, 51.07966971, 59.18853252, 33.77925678, 29.89841068, 11.93818179, 21.20677241, 19.59249791, 52.61610864, 96.78703861, 44.25003138, 25.45761643, 60.78667816, 35.86366259, 47.55280799, 71.45801283, 56.63714015, 33.78940455, 72.3824734, 68.93679761, 34.26225319, 20.08720651, 73.8855593, 
            10.94657474, 92.81466437, 13.97649424, 59.6220993, 17.78859164, 60.61768665, 26.52282767, 64.5245086, 62.22446855, 58.02159669, 27.09423371, 39.38799753, 88.89411313, 71.24117848, 78.04082826, 11.49331664, 49.79554909, 43.49963796, 12.14328716],
    "Price": [806.315316, 953.0093961, 269.2291183, 294.1813915, 284.9398308, 757.8550341, 200.1901136, 325.3476996, 200.5285812, 331.832346, 923.9447978, 180.1339119, 411.1042287, 693.126802, 379.0956117, 749.7787534, 582.628865, 754.5233198, 165.6911397, 432.7995813, 482.9956055, 262.3900046, 472.7389584, 365.8526944, 672.0948864, 292.2904241, 812.9500513, 503.9160352,
            179.7908951, 453.1510675, 277.334889, 583.9452288, 316.7631419, 928.942652, 595.333813, 769.6073875, 234.0649365, 576.6673517, 732.9649572, 797.6565017, 846.6650573, 499.7289979, 327.8650434, 163.4815502, 359.1735163, 501.7959383, 162.6866372, 381.1513866, 501.5300381, 206.5293606, 597.9466261, 340.5964282, 457.0445343, 786.0202687, 211.1464937, 918.6126975,
            612.0573444, 299.5389254, 651.900255, 157.8385589, 771.9376063, 471.1682652, 271.6213386, 579.0718318, 215.2652791, 659.089675, 416.0224583, 735.9583947, 209.3694877, 362.9287311, 432.2695448, 745.9163482, 484.2750601, 218.6843798, 145.2051687, 912.8186793, 650.01556, 853.6805569, 694.9899112, 256.0904422, 511.9970934, 395.1216007, 737.5813434, 774.3446902,
            706.6696702, 883.4720743, 300.9140671, 939.1258159, 273.1916015, 735.009046, 335.7085317, 297.5977062, 170.0963766, 673.3999483, 176.3852432, 554.6763588, 223.355441, 936.1309097, 881.1072344,488.5901807, 487.4801668, 918.5110143, 429.019907, 199.662613, 616.2537953, 665.6187281, 690.0180919, 309.1132579, 943.1652832, 965.4951346, 534.6415934, 299.6420826, 
            165.1782043, 169.5782327, 556.9167498, 578.3841936, 333.2244669, 808.2081844, 646.9025673, 192.6469677, 153.8664916, 468.1117839, 511.9391174, 193.0645864, 228.7696769, 174.9979384, 400.9489306, 504.8719231, 634.1862123, 633.7688753, 931.9128131, 259.0519308, 152.0633173, 878.0001369, 232.9572042, 504.2565447, 151.9692002, 931.2436746, 856.877784, 968.66828,
            641.6374349, 587.6220432, 649.6356601, 356.4233263, 414.7340411, 701.9204832, 119.0489254, 658.5135806, 465.7661254, 684.2901989, 969.808703, 287.2007397, 148.2264498, 174.5806305, 479.0978953, 151.0999058, 351.7350804, 713.3114851, 292.0937994, 535.8602492, 396.6988009, 477.1533179, 758.6707507, 799.2999346, 377.3807287, 452.114682, 221.6669418, 914.8278429,
            506.1231717, 301.3147119, 640.6233141, 865.7912448, 125.1033263, 810.9768337, 894.8096652, 780.9521239, 965.5342777, 332.1187669, 913.4847042, 689.2771733, 912.6099379, 839.7376106, 134.8163777, 152.6028605, 338.2728917, 620.1805458, 161.4748573, 895.4723826, 864.4855474, 962.2056816, 405.191106, 848.7822637, 754.1133718, 583.2990862, 616.340368, 862.5357849,
            921.916335, 215.3901086, 419.9883629, 148.6184799, 304.1596605, 652.0456834, 689.9607518, 848.4683581, 686.9240061, 916.9846611, 195.180367, 203.8862523, 916.9099827, 546.5911429, 786.3971125, 237.1303334, 331.3871677, 444.4170662, 469.7913619, 209.8157598, 139.314475, 260.116067, 424.1324572, 484.9315956, 723.9409284, 661.395048, 559.739891, 229.2003914, 630.2210514,
            943.9424682, 408.6769898, 267.2073775, 522.3957545, 948.5760305, 596.8178691, 620.1940074, 662.4154962, 941.1334211, 360.2706503, 439.1343365, 484.8940335, 870.9023909, 515.6297996, 380.3238446, 951.4204627, 889.705165, 460.7155019, 764.0303258, 486.9584833, 801.7347453, 351.8487748, 895.8244683, 686.424861, 374.0314797, 901.9005196, 655.7971712, 797.0363611, 592.3909341,
            611.3300978, 169.3850457, 401.6639757, 778.2793835, 510.229522, 596.5958523, 348.1143013, 310.7886865, 145.3469569, 230.2948179, 203.4394967, 528.4871686, 950.7656524, 451.8415748, 270.7478337, 605.7532461, 367.5532274, 477.4903317, 699.8529515, 567.792962, 352.2511722, 719.8065408, 681.9581791, 346.3504439, 221.8935034, 730.7784998, 135.2278488, 909.0369186, 154.4996595,
            599.3919383, 202.935398, 600.1766509, 285.2458775, 637.4587053, 624.8494146, 583.0974115, 286.0647986, 409.0498449, 867.2252349, 703.5633301, 768.6477513, 141.4039155, 499.2552049, 447.9635213, 137.9745672]

}

df = pd.DataFrame(data)

x = df [["Size"]]
y = df[["Price"]]

model = LinearRegression()
model.fit(x, y)

def predict_price(size):
    result = model.predict([[size]])[0][0]
    return result

def graphic(size, predicted_price):
    plt.figure(figsize=(6,4))
    plt.scatter(df ["Size"], df["Price"], color = "blue", label = "Actual data")
    plt.plot (df["Size"], model.predict(df[["Size"]]), color = "pink", label = "Linear regression")
    plt.scatter ([size], [predicted_price], color = "red", label = "Prediction", marker = "x", s=100)
    plt.xlabel ("Size(mÂ²)")
    plt.ylabel ("Price(USD)")
    plt.title("House price prediction")
    plt.legend()

    img = io.BytesIO()
    plt.savefig(img, format = "png")
    img.seek(0)


    plot_url = base64.b64encode (img.getvalue()).decode()
    return plot_url